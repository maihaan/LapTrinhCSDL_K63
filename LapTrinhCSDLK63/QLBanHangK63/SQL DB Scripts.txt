USE [LTCSDLK63]
GO

/****** Object:  Table [dbo].[tbPhanLoai]    Script Date: 08/19/2021 14:51:48 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[tbPhanLoai](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Ma] [nvarchar](50) NULL,
	[Ten] [nvarchar](max) NULL,
 CONSTRAINT [PK_tbPhanLoai] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO


USE [LTCSDLK63]
GO

/****** Object:  Table [dbo].[tbHang]    Script Date: 08/19/2021 14:54:16 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[tbHang](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Ma] [nvarchar](50) NULL,
	[Ten] [nvarchar](max) NULL,
	[MoTa] [nvarchar](max) NULL,
	[MaPhanLoai] [nvarchar](50) NULL,
	[DVT] [nvarchar](50) NULL,
	[DonGia] [int] NULL,
	[SoLuong] [int] NULL,
 CONSTRAINT [PK_tbHang] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO


CREATE PROCEDURE spThemPhanLoai 
	-- Add the parameters for the stored procedure here
	@ma nvarchar(50), 
	@ten nvarchar(max),
	@ketQua int out
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Kiem tra xem ma them vao da ton tai hay chua
	declare @kt int;
	set @kt = (Select ID from tbPhanLoai Where Ma=@ma);
	if(@kt > 0)
	Begin
		-- Da ton tai thi bao -2 va ket thuc
		Set @ketQua=-2;
		return;
	End
	
	-- Neu chua ton tai thi them vao
	Insert into tbPhanLoai(Ma, Ten) values(@ma, @ten);
	Set @ketQua = (Select ID from tbPhanLoai Where ma=@ma);
END
GO

Create PROCEDURE spSuaPhanLoai 
	-- Add the parameters for the stored procedure here
	@ma nvarchar(50), 
	@ten nvarchar(max),
	@ketQua int out
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Kiem tra xem ma them vao da ton tai hay chua
	declare @kt int;
	set @kt = (Select ID from tbPhanLoai Where Ma=@ma);
	if(@kt > 0)
		Begin
			-- Da ton tai thi cap nhat gia tri
			Update tbPhanLoai Set Ten=@ten Where Ma=@ma;
			Set @ketQua = (Select ID from tbPhanLoai Where ma=@ma and Ten=@ten);
		End
	else
		Begin
			-- Chua ton tai
			Set @ketQua=-2;
			return;
		End
END
GO
